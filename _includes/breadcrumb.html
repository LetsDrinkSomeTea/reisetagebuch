{% comment %}
Reusable Breadcrumb Component
Parameters:
- page: current page object (auto-passed)
- Automatically detects page type and builds appropriate breadcrumb trail

Usage: {% include breadcrumb.html %}
{% endcomment %}

{% assign allowed_layouts = 'country,city,day' | split: ',' %}
{% assign current_layout = page.layout | default: '' %}
{% assign show_breadcrumb = false %}

{% if allowed_layouts contains current_layout %}
  {% assign show_breadcrumb = true %}
{% endif %}

{% if show_breadcrumb %}
<div class="breadcrumb">
  <a href="{{ '/' | relative_url }}">ğŸ </a>
  
  {% comment %} Auto-detect country from first city if not set {% endcomment %}
  {% assign page_country = page.country %}
  {% unless page_country %}
    {% assign first_city = page.city | array | first %}
    {% if first_city %}
      {% assign first_city_data = site.data.cities[first_city] %}
      {% if first_city_data %}
        {% assign page_country = first_city_data.country %}
      {% endif %}
    {% endif %}
  {% endunless %}
  
  {% if page_country %}
    {% assign country_data = site.data.countries[page_country] %}
    <span class="separator">â€º</span>

    {% assign country_key = page_country %}
    {% assign country_page = site.pages | where: 'layout', 'country' | where: 'country', country_key | first %}
    {% if country_page %}
      {% assign country_url = country_page.url %}
    {% else %}
      {% assign country_url = '/places/' | append: country_key | append: '/' %}
    {% endif %}
    {% assign is_country_link = page.layout == 'day' or page.layout == 'city' %}

    {% if is_country_link %}
      <a href="{{ country_url | relative_url }}">
        {{ country_data.flag }} {{ country_data.name }}
      </a>
    {% else %}
      <span class="current">{{ country_data.flag }} {{ country_data.name }}</span>
    {% endif %}

    {% if page.city or include.city %}
      {% assign city_key = include.city | default: page.city %}
      {% if city_key.first %}
        {% assign city_key = city_key | first %}
      {% endif %}
      {% assign city_data = site.data.cities[city_key] %}
      <span class="separator">â€º</span>

      {% if page.layout == "day" %}
        {% assign city_page = site.pages | where: 'layout', 'city' | where: 'country', country_key | where: 'city', city_key | first %}
        {% if city_page %}
          {% assign city_url = city_page.url %}
        {% else %}
          {% assign city_url = '/places/' | append: country_key | append: '/' | append: city_key | append: '/' %}
        {% endif %}
        <a href="{{ city_url | relative_url }}">
          {{ city_data.emoji }} {{ city_data.name }}
        </a>
        <span class="separator">â€º</span>
        <span class="current">Tag {{ page.day }}</span>
      {% else %}
        <span class="current">{{ city_data.emoji }} {{ city_data.name }}</span>
      {% endif %}
    {% endif %}
  {% elsif page.layout == "gallery" %}
    <span class="separator">â€º</span>
    <span class="current">ğŸ“¸ Galerie</span>
  {% endif %}
</div>
{% endif %}
