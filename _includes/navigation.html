<nav class="navigation">
  <!-- Countries Navigation -->
  {% for country in site.data.countries %}
    {% assign country_key = country[0] %}
    {% assign country_data = country[1] %}
    
    <div class="country-section">
      <!-- Country Link -->
      {% assign country_page = site.pages | where: "country", country_key | where: "layout", "country" | first %}
      <a href="{% if country_page %}{{ country_page.url | relative_url }}{% else %}{{ '/' | append: country_key | append: '/' | relative_url }}{% endif %}" 
         class="country-link{% if page.country == country_key %} active{% endif %}">
        {{ country_data.flag }} {{ country_data.name }}
      </a>
      
      <!-- Cities List -->
      <ul class="cities-list">
        {% for city in country_data.cities %}
          {% assign city_key = city[0] %}
          {% assign city_data = city[1] %}
          
          <li class="city-section">
            <!-- City Link -->
            {% assign city_page = site.pages | where: "country", country_key | where: "city", city_key | where: "layout", "city" | first %}
            <a href="{% if city_page %}{{ city_page.url | relative_url }}{% else %}{{ '/' | append: country_key | append: '/' | append: city_key | append: '/' | relative_url }}{% endif %}" 
               class="city-link{% if page.country == country_key and page.city == city_key %} active{% endif %}">
              {{ city_data.emoji }} {{ city_data.name }}
            </a>
            
            <!-- Days List -->
            {% assign country_pages = site.pages | where: "country", country_key | where: "city", city_key %}
            {% assign day_pages = country_pages | where: "layout", "day" | sort: "day" %}
            
            {% if day_pages.size > 0 %}
              <ul class="days-list">
                {% for day_page in day_pages %}
                  <li>
                    <a href="{{ day_page.url | relative_url }}" 
                       class="day-link{% if page.url == day_page.url %} active{% endif %}">
                      Tag {{ day_page.day }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
  
  <!-- Latest Entries Section -->
  <div class="latest-entries">
    <h3>📝 Neueste Einträge</h3>
    
    <!-- Collect all day pages from all countries -->
    {% assign all_day_pages = site.pages | where: "layout", "day" | sort: "date" | reverse %}
    
    {% if all_day_pages.size > 0 %}
      {% assign recent_entries = all_day_pages | limit: 5 %}
      
      {% for entry in recent_entries %}
        {% assign country_data = site.data.countries[entry.country] %}
        {% assign city_data = country_data.cities[entry.city] %}
        
        <div class="entry-item">
          <span class="entry-date">{{ entry.date | date: '%d.%m' }}</span>
          <a href="{{ entry.url | relative_url }}">
            {{ country_data.flag }} {{ city_data.name }} - Tag {{ entry.day }}
          </a>
        </div>
      {% endfor %}
    {% else %}
      <p style="font-size: 0.85rem; color: var(--text-light); font-style: italic;">
        Noch keine Einträge vorhanden
      </p>
    {% endif %}
  </div>

</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Highlight active navigation items
  const currentPath = window.location.pathname;
  const navLinks = document.querySelectorAll('.navigation a');
  
  navLinks.forEach(link => {
    const linkPath = link.getAttribute('href');
    if (linkPath && currentPath.includes(linkPath) && linkPath !== '/') {
      link.classList.add('active');
      
      // Also expand parent sections
      let parent = link.closest('.country-section');
      if (parent) {
        parent.classList.add('expanded');
      }
    }
  });
  
  // Smooth scrolling for navigation links
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      // Only apply smooth scrolling for anchor links
      if (this.getAttribute('href').startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    });
  });
});
</script>
