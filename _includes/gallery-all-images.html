{% comment %}
Gallery All Images - Displays ALL images from all day directories across all countries
Shows all 7 image types: morning, breakfast, lunch, afternoon, evening, dinner, main
{% endcomment %}

{% assign image_types = "morning:🌅 Vormittag,breakfast:🥐 Frühstück,lunch:🍜 Mittagessen,afternoon:🌆 Nachmittag,evening:🌙 Abend,dinner:🍽️ Abendessen,main:📸 Hauptbild" | split: "," %}
{% assign type_map = "" %}
{% for type_pair in image_types %}
  {% assign parts = type_pair | split: ":" %}
  {% assign type_map = type_map | append: parts[0] | append: "=" | append: parts[1] | append: "||" %}
{% endfor %}

{% comment %} Collect all images from tag-X directories {% endcomment %}
{% assign all_gallery_images = "" | split: "" %}

{% for file in site.static_files %}
  {% if file.path contains "/tag-" %}
    {% if file.extname == '.jpg' or file.extname == '.jpeg' or file.extname == '.JPG' or file.extname == '.JPEG' %}
      {% assign path_parts = file.path | split: "/" %}
      {% if path_parts.size >= 4 %}
        {% assign country_key = path_parts[-4] %}
        {% assign city_key = path_parts[-3] %}
        {% assign tag_dir = path_parts[-2] %}
        {% assign image_name = path_parts[-1] | split: "." | first %}
        
        {% comment %} Extract day number from tag directory (e.g., "tag-1" -> "1") {% endcomment %}
        {% assign day_number = tag_dir | remove: "tag-" %}
        
        {% comment %} Create image object {% endcomment %}
        {% assign image_obj = "" | split: "" %}
        {% assign image_obj = image_obj | push: file.path %}
        {% assign image_obj = image_obj | push: country_key %}
        {% assign image_obj = image_obj | push: city_key %}
        {% assign image_obj = image_obj | push: day_number %}
        {% assign image_obj = image_obj | push: image_name %}
        
        {% assign all_gallery_images = all_gallery_images | push: image_obj %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if all_gallery_images.size > 0 %}
<section class="gallery-all-images-section">
  <div class="gallery-all-images">
    {% for image_data in all_gallery_images %}
      {% assign image_path = image_data[0] %}
      {% assign country_key = image_data[1] %}
      {% assign city_key = image_data[2] %}
      {% assign day_number = image_data[3] %}
      {% assign image_type = image_data[4] %}
      
      {% comment %} Get country and city data {% endcomment %}
      {% assign country_data = site.data.countries[country_key] %}
      {% assign city_data = country_data.cities[city_key] %}
      {% assign city_name = city_data.name | default: city_key %}
      {% assign city_emoji = city_data.emoji | default: "🏙️" %}
      
      <div class="gallery-all-card">
        <a href="{{ image_path | relative_url }}" class="gallery-link" 
           title="Tag {{ day_number }}, {{ city_name }}, {{ country_data.name }}"
           data-modal-title="Tag {{ day_number }}, {{ city_name }}, {{ country_data.name }}">
          <div class="gallery-image-container">
            <img src="{{ image_path | relative_url }}" 
                 alt="Bild aus {{ city_name }}, Tag {{ day_number }}" 
                 loading="lazy" />
            <div class="gallery-overlay">
              <div class="gallery-info">
                <span class="gallery-city-badge">{{ city_emoji }} {{ city_name }}</span>
                <span class="gallery-day-badge">Tag {{ day_number }}</span>
              </div>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>
</section>

{% comment %} Re-initialize gallery links for modal system {% endcomment %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  if (window.reinitGallery) {
    window.reinitGallery();
  }
});
</script>

{% endif %}