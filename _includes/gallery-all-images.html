{% comment %}
Gallery All Images - Displays ALL images from all day directories across all countries
Shows all 7 image types: morning, breakfast, lunch, afternoon, evening, dinner, main
{% endcomment %}


{% comment %} Collect all images from tag-X directories {% endcomment %}
{% assign all_gallery_images = "" | split: "" %}

{% for file in site.static_files %}
  {% if file.path contains "/tag-" %}
    {% if file.extname == '.jpg' or file.extname == '.jpeg' or file.extname == '.JPG' or file.extname == '.JPEG' %}
      {% assign path_parts = file.path | split: "/" %}
      {% if path_parts.size >= 4 %}
        {% assign country_key = path_parts[-4] %}
        {% assign city_key = path_parts[-3] %}
        {% assign tag_dir = path_parts[-2] %}
        {% assign image_name = path_parts[-1] | split: "." | first %}
        
        {% comment %} Extract day number from tag directory (e.g., "tag-1" -> "1") {% endcomment %}
        {% assign day_number = tag_dir | remove: "tag-" %}
        
        {% comment %} Create image object {% endcomment %}
        {% assign image_obj = "" | split: "" %}
        {% assign image_obj = image_obj | push: file.path %}
        {% assign image_obj = image_obj | push: country_key %}
        {% assign image_obj = image_obj | push: city_key %}
        {% assign image_obj = image_obj | push: day_number %}
        {% assign image_obj = image_obj | push: image_name %}
        
        {% assign all_gallery_images = all_gallery_images | push: image_obj %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if all_gallery_images.size > 0 %}
<section class="gallery__section">
  <div class="gallery">
    {% for image_data in all_gallery_images %}
      {% assign image_path = image_data[0] %}
      {% assign country_key = image_data[1] %}
      {% assign city_key = image_data[2] %}
      {% assign day_number = image_data[3] %}
      {% assign image_type = image_data[4] %}
      
      {% comment %} Get country and city data {% endcomment %}
      {% assign country_data = site.data.countries[country_key] %}
      {% assign city_data = country_data.cities[city_key] %}
      {% assign city_name = city_data.name | default: city_key %}
      {% assign city_emoji = city_data.emoji | default: "🏙️" %}
      
      {% comment %} Get image type data {% endcomment %}
      {% assign image_type_data = site.data.image-types[image_type] %}
      {% assign image_name = image_type_data.name | default: image_type %}
      {% assign image_icon = image_type_data.icon | default: "🖼️" %}
      
      <div class="gallery__card">
        <a href="{{ image_path | relative_url }}" class="gallery__link" 
           title="Tag {{ day_number }}, {{ city_name }}, {{ country_data.name }}"
        data-modal-title="Tag {{ day_number }}, {{ city_name }}, {{ country_data.name }} - {{ image_icon }} {{ image_name }}">
          <div class="gallery__image-container">
            <img src="{{ image_path | relative_url }}" 
                 alt="Bild aus {{ city_name }}, Tag {{ day_number }}" 
                 loading="lazy" />
            <div class="gallery__overlay">
              <div class="gallery__info">
                <span class="badge badge--light">{{ city_emoji }} {{ city_name }}</span>
                <span class="badge badge--light">{{ image_icon }}</span>
                <span class="badge badge--primary">Tag {{ day_number }}</span>
              </div>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>
</section>

{% comment %} Re-initialize gallery links for modal system {% endcomment %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  if (window.reinitGallery) {
    window.reinitGallery();
  }
});
</script>

{% endif %}
