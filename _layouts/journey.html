---
layout: default
---

<article class="journey-page">
  {% include page-header.html %}

  <div class="page-content">
    {{ content }}
  </div>

  {% assign entries = site.pages | where: "layout", "day" | where: "journey", page.journey | sort: "date" %}
  {% assign entries_count = entries.size %}

  <section class="journey-stats">
    <h2>Übersicht</h2>
    {% assign first_page = entries | first %}
    {% assign last_page = entries | last %}
    {% if entries_count > 0 %}
      <p>
        {{ entries_count }} {% if entries_count == 1 %}Eintrag{% else %}Einträge{% endif %}
        {% if first_page and last_page %} · {{ first_page.date | date: '%d.%m.%Y' }} – {{ last_page.date | date: '%d.%m.%Y' }}{% endif %}
        <span class="badge badge--secondary" style="margin-left: .5rem;">Letztes Update: {{ last_page.date | date: '%d.%m.%Y' }}</span>
      </p>
      {% comment %} Preview the most recently updated cities (max 3) {% endcomment %}
      {% assign by_city = entries | reverse | group_by: 'city' %}
      {% if by_city and by_city.size > 0 %}
        <div class="cities-preview">
          {% assign shown = 0 %}
          {% for grp in by_city %}
            {% if shown < 3 %}
              {% assign example = grp.items | first %}
              {% assign country_data = site.data.countries[example.country] %}
              {% assign city_data = country_data.cities[grp.name] %}
              {% assign city_pages = site.pages | where: "layout", "city" | where: "country", example.country | where: "city", grp.name %}
              {% assign city_page = city_pages | first %}
              {% if city_page %}
                <a class="city-tag" href="{{ city_page.url | relative_url }}">{{ city_data.emoji }} {{ city_data.name }}</a>
                {% assign shown = shown | plus: 1 %}
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    {% else %}
      <p>Noch keine Einträge in dieser Reise.</p>
    {% endif %}
  </section>

  <section class="journey-places">
    <h2>Besuchte Orte</h2>
    {% assign all_days = entries %}
    {% for country in site.data.countries %}
      {% assign country_key = country[0] %}
      {% assign country_data = country[1] %}
      {%- assign cities_with_entries = 0 -%}
      {%- for city in country_data.cities -%}
        {%- assign city_key = city[0] -%}
        {%- assign city_days = all_days | where: "country", country_key | where: "city", city_key -%}
        {%- if city_days.size > 0 -%}
          {%- assign cities_with_entries = cities_with_entries | plus: 1 -%}
        {%- endif -%}
      {%- endfor -%}
      {% if cities_with_entries > 0 %}
        <h3>{{ country_data.flag }} {{ country_data.name }}</h3>
        <div class="grid grid--cities">
          {% for city in country_data.cities %}
            {% assign city_key = city[0] %}
            {% assign city_data = city[1] %}
            {% assign day_pages = all_days | where: "country", country_key | where: "city", city_key %}
            {% if day_pages.size > 0 %}
              {% assign city_pages = site.pages | where: "layout", "city" | where: "country", country_key | where: "city", city_key %}
              {% assign city_page = nil %}
              {% for p in city_pages %}
                {% if p.path contains 'places/' %}
                  {% assign city_page = p %}
                  {% break %}
                {% endif %}
              {% endfor %}
              {% unless city_page %}
                {% assign city_page = city_pages | first %}
              {% endunless %}
              {% include card.html type="city" item=city_page country_data=country_data city_data=city_data day_pages=day_pages %}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    {% endfor %}
  </section>

  <section class="journey-latest">
    <h2>Neueste Einträge</h2>
    {% assign latest = entries | sort: "date" | reverse %}
    <div class="grid grid--days">
      {% for day_page in latest limit: 9 %}
        {% include card.html type="day" item=day_page %}
      {% endfor %}
    </div>
  </section>
</article>
