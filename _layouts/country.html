---
layout: default
---

<article class="country-page">
  {% assign country_data = site.data.countries[page.country] %}
  {% include page-header.html %}

  <div class="page-content">
    {{ content }}
  </div>

  <section class="cities-overview">
    <h2>St채dte</h2>
    
    {% comment %} Collect all cities from cities.yml that belong to this country {% endcomment %}
    {% assign country_cities = '' | split: '' %}
    {% for city in site.data.cities %}
      {% assign city_key = city[0] %}
      {% assign city_data = city[1] %}
      {% if city_data.country == page.country %}
        {% assign country_cities = country_cities | push: city_key %}
      {% endif %}
    {% endfor %}
    
    {% assign all_pages = site.pages | where: 'layout', 'day' %}
    <!-- Count cities with day entries first -->
    {% assign cities_with_content = 0 %}
    {% for city_key in country_cities %}
      {% assign collected_days = '' | split: '' %}
      {% for day_page in all_pages %}
        {% assign city_list = day_page.city | array %}
        {% if city_list contains city_key %}
          {% assign collected_days = collected_days | push: day_page %}
        {% endif %}
      {% endfor %}
      {% if collected_days.size > 0 %}
        {% assign cities_with_content = cities_with_content | plus: 1 %}
      {% endif %}
    {% endfor %}
    
    {% if cities_with_content > 0 %}
      <div class="grid grid--cities">
        {% for city_key in country_cities %}
          {% assign city_data = site.data.cities[city_key] %}

          <!-- Find city index page -->
          {% assign city_page = site.pages | where: 'layout', 'city' | where: 'city', city_key | first %}

          <!-- Collect day entries for this city -->
          {% assign city_day_pages = '' | split: '' %}
          {% for day_page in all_pages %}
            {% assign city_list = day_page.city | array %}
            {% if city_list contains city_key %}
              {% assign city_day_pages = city_day_pages | push: day_page %}
            {% endif %}
          {% endfor %}

          <!-- Only show cities that have day entries -->
          {% if city_day_pages.size > 0 %}
            {% include card.html type='city' item=city_page city=city_key day_pages=city_day_pages %}
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <div class="no-entries">
        <p>Noch keine St채dte mit Tagebucheintr채gen in {{ country_data.name }}. Die Eintr채ge erscheinen hier, sobald die Reise beginnt!</p>
      </div>
    {% endif %}
  </section>

  {% comment %} Country Image Gallery {% endcomment %}
  {% include gallery.html scope="country" country=page.country %}
</article>
